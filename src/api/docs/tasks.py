"""Documentation strings для Tasks API."""

CREATE_TASK = """
Создаёт асинхронную задачу генерации текста и добавляет её в очередь обработки.

## Как это работает

1. Запрос валидируется и создаётся задача со статусом `pending`
2. Задача добавляется в priority queue
3. Возвращается `task_id` для отслеживания статуса
4. Задача обрабатывается в фоновом режиме
5. Результат можно получить через `GET /tasks/{task_id}` или webhook

## Lazy Loading

Модели активируются автоматически при первом использовании.
Список доступных моделей: `GET /models/presets`

## Основные параметры

| Параметр | Тип | Описание |
|----------|-----|----------|
| `model` | string | Имя модели из пресетов (см. `/models/presets`) |
| `prompt` | string | Текст промпта |
| `temperature` | float | Температура (0.0-2.0) |
| `max_tokens` | int | Максимум токенов в ответе |

## Дополнительные параметры

| Параметр | Тип | Описание |
|----------|-----|----------|
| `response_format` | object | Structured Output (JSON Schema) |
| `idempotency_key` | string | Ключ дедупликации (TTL: 24 часа) |
| `webhook_url` | string | URL для callback при завершении |
| `priority` | int | Приоритет в очереди (0-100, больше = раньше) |

## Structured Output

Для получения структурированного JSON укажите `response_format` с типом `json_schema`
и JSON Schema в поле `json_schema`.

## Idempotency

При повторном запросе с тем же `idempotency_key` вернётся существующая задача вместо создания новой.

## Приоритет

Поле `priority` (0-100) определяет порядок обработки.
Задачи с большим приоритетом обрабатываются первыми.
"""

GET_TASK_STATUS = """
Возвращает текущий статус задачи и результат генерации (если задача завершена).

## Статусы задачи

| Статус | Описание |
|--------|----------|
| `pending` | Задача в очереди, ожидает обработки |
| `processing` | Задача выполняется |
| `completed` | Генерация успешно завершена |
| `failed` | Произошла ошибка |

## Polling

Опрашивайте этот endpoint с интервалом 1-2 секунды до получения статуса `completed` или `failed`.

## Структура результата (при status=completed)

| Поле | Описание |
|------|----------|
| `result.text` | Сгенерированный текст |
| `result.finish_reason` | Причина завершения |
| `result.usage.prompt_tokens` | Токены в промпте |
| `result.usage.completion_tokens` | Токены в ответе |
| `result.usage.total_tokens` | Всего токенов |

## Finish Reasons

| Reason | Описание |
|--------|----------|
| `stop` | Генерация завершена естественно |
| `length` | Достигнут лимит max_tokens |
| `content_filter` | Контент заблокирован фильтром |

## Observability

Поле `trace_id` содержит ID трейса в Langfuse для отладки.
"""

DELETE_TASK = """
Удаляет завершённую задачу из хранилища сессий.

## Когда можно удалить

Задачу можно удалить только если она в финальном статусе:
- `completed` — успешно завершена
- `failed` — завершена с ошибкой

## Когда нельзя удалить

Нельзя удалить задачу в статусе:
- `pending` — ожидает в очереди
- `processing` — выполняется

В этих случаях вернётся ошибка **409 Conflict**.

## Зачем удалять задачи

- Освобождение места в Redis
- Очистка после обработки результата
- GDPR compliance (удаление данных)

## Примечание

- Удаление необратимо
- Результат задачи будет потерян
- Задачи автоматически удаляются по TTL (настраивается)
"""

GET_TASK_REPORT = """
Возвращает детальный отчёт о выполнении задачи включая:

## Содержимое отчёта

### Базовая информация
- **task_id** — ID задачи
- **status** — Текущий статус
- **model** — Использованная модель

### Временные метки
- **created_at** — Время создания
- **started_at** — Время начала обработки
- **finished_at** — Время завершения

### Метрики выполнения
- **queue_wait_ms** — Время ожидания в очереди
- **inference_ms** — Время генерации
- **total_ms** — Общее время выполнения

### Использование ресурсов
- **tokens** — Статистика токенов (prompt, completion, total)
- **model_info** — Информация о модели

### Логи
- **logs** — Все логи задачи с timestamps

## Использование

- Отладка медленных задач
- Анализ производительности
- Сбор метрик для мониторинга
"""
