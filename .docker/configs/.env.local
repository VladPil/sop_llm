# ========================================
# SOP LLM Service - Local Environment
# ========================================
# Для локальной разработки с централизованной инфраструктурой

# ========================================
# Application Settings
# ========================================
APP_NAME=SOP LLM Service
APP_ENV=development
DEBUG=true
LOG_LEVEL=INFO

# ========================================
# Server Settings
# ========================================
SERVER_HOST=0.0.0.0
SERVER_PORT=8000

# ========================================
# Infrastructure Connection (sop_infrastructure)
# ========================================

# PostgreSQL (подключение к централизованной БД)
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
POSTGRES_USER=sop_admin
POSTGRES_PASSWORD=change_me_in_production
POSTGRES_DB=sop_llm_db

# Redis (подключение к централизованному Redis)
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=change_me_in_production
REDIS_DB=1  # Уникальный для sop_llm (0 для intake, 1 для llm, 2 для s3)
REDIS_URL=redis://redis:6379/1

# Kafka (подключение к централизованному Kafka)
KAFKA_BOOTSTRAP_SERVERS=kafka:9092

# ========================================
# Service Ports (согласно PORT_MAPPING.md)
# ========================================
# sop_llm: блок 8200-8299
APP_PORT=8200      # Внешний порт API
METRICS_PORT=8291  # Внешний порт metrics

# ========================================
# Redis Settings
# ========================================
SESSION_TTL_SECONDS=3600
IDEMPOTENCY_TTL_SECONDS=86400
LOGS_MAX_RECENT=100

# ========================================
# LLM Settings
# ========================================
MODELS_DIR=/app/models
DEFAULT_CONTEXT_WINDOW=4096
DEFAULT_MAX_TOKENS=2048

# HuggingFace Cache
HUGGINGFACE_TOKEN=${HUGGINGFACE_TOKEN}

# ========================================
# GPU Settings
# ========================================
GPU_INDEX=0
MAX_VRAM_USAGE_PERCENT=90.0
VRAM_RESERVE_MB=512

# GPU Support для Docker
INSTALL_GPU=false
CUDA_VERSION=12.1.0
DEVICE=cpu

# ========================================
# External API Keys
# ========================================
OPENAI_API_KEY=${OPENAI_API_KEY}
OPENAI_BASE_URL=${OPENAI_BASE_URL}

ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}

OPENAI_COMPATIBLE_BASE_URL=${OPENAI_COMPATIBLE_BASE_URL}
OPENAI_COMPATIBLE_API_KEY=${OPENAI_COMPATIBLE_API_KEY}

# ========================================
# JSON Fixer Settings
# ========================================
ENABLE_JSON_FIXING=false
JSON_FIXER_TIMEOUT=30

# ========================================
# HTTP Settings
# ========================================
WEBHOOK_TIMEOUT_SECONDS=30
WEBHOOK_MAX_RETRIES=3
HTTP_TIMEOUT_SECONDS=60
HTTP_MAX_RETRIES=2

# ========================================
# CORS Settings
# ========================================
CORS_ALLOWED_ORIGINS=*

# ========================================
# Performance
# ========================================
WORKERS=2
THREADS=8
TORCH_NUM_THREADS=8
OMP_NUM_THREADS=8

# ========================================
# Logging Settings
# ========================================
LOG_FORMAT=json
